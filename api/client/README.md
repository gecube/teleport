### Getting started

A fair amount of Teleport knowledge is expected before getting started. Make sure to familiarize yourself with the [admin manual](https://goteleport.com/docs/admin-guide/) and other Teleport documentation.

Before you begin:

- Install [Go](https://golang.org/doc/install) 1.15+ and Setup Go Dev Environment
- Set up Teleport with ([Getting Started Guide](getting-started.mdx))

The easiest way to get started with the Teleport API client is to clone the [Go Client Example](https://github.com/gravitational/teleport/tree/master/examples/go-client) in our github repo. Follow the README there to quickly authenticate the API with your Teleport Auth Server.

If you want to start from scratch, simply set up a go module and run: 

```bash
$ go get github.com/gravitational/teleport/api
```

Then, follow the client documentation below to get the client up and running.

### Creating a Client

The Client uses Credentials to authenticate and connect the client. There are several Credential options, but the simplest to get started with are Profile Credentials.

```bash
# generate tsh profile for the API to use for authentication
$ tsh login --user=api-user
```

Profile Credentials Automatically retrieve SSH and TLS certificates and a public proxy
address from the current profile.

```go
clt, err := client.New(ctx, client.Config{
    Credentials: []client.Credentials{
        client.LoadProfile("", ""),
    },
    // set to true if your web proxy doesn't have HTTP/TLS certificate
    // configured yet (never use this in production).
    InsecureAddressDiscovery: false,
})
```

### Credentials

Credentials use TLS certificates to authenticate the client's connection to the
Auth server. These TLS certificates must be associated with a Teleport user, which
allows the client to comply with role based access control. Once authenticated,
the client will be authorized to call client methods that the underlying user has
permissions for.

For example, the client user must have permission to perform "list" on "roles" in orer to call:
role, err := clt.GetRole(ctx, "role1")

see https://goteleport.com/docs/access-controls/reference/#roles for more details
on role based access control.

Credential loaders can be used to find and certificates generated by Teleport
CLIs (https://goteleport.com/docs/cli-docs/) and load them into Credentials.

Since there are several Credential loaders to choose from, here are some details to differentiate them by:

| Type | Profile Credentials | Identity Credentials | Key Pair Credentials | TLS Credentials |
| - | - | - | - | - | 
| Ease of use | easy | easy | med | hard | 
| Supports long lived certificates | not easily (configurable on server side) | yes | yes | yes | 
| Supports proxy connections | yes | yes (6.1+) | no | no | 
| Automatic Proxy Address discovery | yes | no | no | no | 
| CLI used | tsh | tctl/tsh | tctl | - | 
| Available in | 6.1+ | 6.0+ | 6.0+ | 6.0+ | 

See the Credentials type for more information and examples.


### Using the Client

The client created above can be used to make a variety of API calls. Below is an
example of creating, getting, and deleting a Role resource object. The client's underlying
user must have "create", "read", and "delete" permissions for the Role resource.

```go
// Resource Spec structs reflect their Resource's yaml definition.
roleSpec := types.RoleSpecV3{
    Options: types.RoleOptions{
        MaxSessionTTL: types.Duration(time.Hour),
    },
    Allow: types.RoleConditions{
        Logins: []string{"role1"},
        Rules: []types.Rule{
            types.NewRule(types.KindAccessRequest, []string{types.VerbList, types.VerbRead}]),
        },
    },
    Deny: types.RoleConditions{
        NodeLabels: types.Labels{"*": []string{"*"}},
    },
}

// There are helper functions for dealing with Teleport resources.
role, err := types.NewRole("role1", spec)
if err != nil {
    return err
}

// Getters and setters can be used to alter specs.
role.SetLogins(types.Allow, []string{""})

// Upsert overwrites the resource if it exists. Use this to create/update resources.
// Equivalent to `tctl create -f role1.yaml`.
role, err := clt.UpsertRole(ctx, "role1")
if err != nil {
    return err
}

// Equivalent to `tctl get role/role1`.
role, err := clt.GetRole(ctx, "role1")
if err != nil {
    return err
}

// Equivalent to `tctl rm role/role1`.
err := clt.DeleteRole(ctx, "role1")
if err != nil {
    return err
}
```
